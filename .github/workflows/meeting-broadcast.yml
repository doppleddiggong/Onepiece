name: Notify Meeting Updates

on:
  repository_dispatch:
    types: [meeting-broadcast]
  workflow_dispatch:
    inputs:
      file_path:
        description: '회의록 파일 경로 (여러 개일 경우 줄바꿈으로 구분)'
        required: false
        type: string

permissions:
  contents: read

jobs:
  notify-meeting:
    runs-on: ubuntu-latest

    steps:
      - name: Prepare meeting file list
        id: files
        run: |
          python .github/scripts/prepare_meeting_broadcast.py \
            --event-path "$GITHUB_EVENT_PATH" \
            --manifest meeting_files.txt

      - name: Send Discord notifications
        if: steps.files.outputs.has_files == 'true'
        env:
          DISCORD_WEBHOOK_DEFAULT: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_WEBHOOK_MEETING: ${{ secrets.DISCORD_WEBHOOK_MEETING_URL }}
        run: |
          python .github/scripts/send_meeting_notifications.py \
            --manifest meeting_files.txt
